<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright (c) 2026 HosamAE
    Licensed under the GNU Lesser General Public License v3.0 or later (LGPL-3.0-or-later)
    See the LICENSE file in the project root for more information.
-->
<templates xml:space="preserve">

<t t-name="web_mindmap_view.MindMapNode">
    <div class="o_mindmap_node_wrapper" t-att-class="{ 'o_mindmap_has_children': hasChildren, 'o_mindmap_root': props.isRoot }">
        <!-- 1. Node Section -->
        <div class="o_mindmap_node_content">
            <div class="o_mindmap_node"
                 t-on-click="onNodeClick"
                 t-on-mouseenter="onMouseEnter"
                 t-on-mouseleave="onMouseLeave"
                 t-att-class="{ 'o_highlighted': isHighlighted }"
                 t-attf-style="border-left: 5px solid {{nodeColor}};">

                <span class="o_mindmap_node_label">
                    <t t-esc="node.data.display_name || node.data.name || ('ID: ' + node.resId)"/>
                </span>

                <!-- Hover Card (Dynamic or Custom) - Absolute positioned via CSS -->
                <t t-if="state.isHovered and (props.CardComponent or (node.extraData and node.extraData.length > 0))">
                    <div class="o_mindmap_hover_card">
                        <t t-if="props.CardComponent">
                            <t t-component="props.CardComponent" record="node.data"/>
                        </t>
                        <t t-else="">
                            <MindMapHoverCard node="node"/>
                        </t>
                    </div>
                </t>
            </div>

            <!-- Ghost Buttons Container (Placed outside node to avoid click collision) -->
            <div class="o_mindmap_node_ghost_buttons" t-if="props.archInfo.canDelete">
                <!-- Delete Button Trigger Area (Top-Right) -->
                <div class="o_mindmap_delete" t-on-click.stop="onDeleteClick" title="Delete Node">
                    <i class="fa fa-times"/>
                </div>
            </div>
        </div>

        <!-- 2. The Bridge (Controls) -->
        <div class="o_mindmap_connector_controls" t-att-class="{ 'o_has_children': hasChildren, 'o_is_expanded': isExpanded }">
            <div t-if="props.archInfo.canCreate" class="o_mindmap_control o_mindmap_add_child" t-on-click.stop="onAddChildClick">
                <i class="fa fa-plus"/>
            </div>
            <t t-if="hasChildren">
               <div class="o_mindmap_control o_mindmap_toggle" t-on-click.stop="onToggleClick">
                    <i t-attf-class="fa {{ isExpanded ? 'fa-caret-down' : 'fa-caret-right' }}"/>
                </div>
            </t>
        </div>

        <!-- 3. Sub-tree -->
        <t t-if="hasChildren and state.wasExpanded">
            <div class="o_mindmap_children" t-att-class="{ 'd-none': !isExpanded }">
                <t t-foreach="node.children" t-as="child" t-key="child.stableKey">
                    <MindMapNode node="child" model="model" archInfo="props.archInfo" CardComponent="props.CardComponent" />
                </t>
            </div>
        </t>
    </div>
</t>

<t t-name="web_mindmap_view.MindMapHoverCard">
    <div class="o_mindmap_hover_content">
        <t t-if="props.node.extraData and props.node.extraData.length > 0">
            <t t-foreach="props.node.extraData" t-as="field" t-key="field.name">
                <div class="o_mindmap_hover_field mb-1">
                    <strong class="o_mindmap_hover_label" t-esc="field.label"/>:
                    <span class="o_mindmap_hover_value ms-1" t-esc="field.value"/>
                </div>
            </t>
        </t>
        <t t-elif="props.node.extraDataLoaded">
            <div class="p-2 text-muted italic">
                <t t-esc="props.node.data.description || 'No extra info available'"/>
            </div>
        </t>
        <t t-else="">
            <div class="p-2 text-center">
                <i class="fa fa-circle-o-notch fa-spin text-primary"/>
            </div>
        </t>
    </div>
</t>

</templates>
