<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>The Dual Legend | Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Aref+Ruqaa&family=Cinzel:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet" />

    <style>
      /* RESET & BASICS */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        background-color: #020617;
        color: #cbd5e1;
        font-family: 'Cinzel', serif;
        overflow-x: hidden;
        transition: background 1s ease;
        min-height: 100vh;
        overscroll-behavior-y: none;
        scroll-behavior: smooth; /* Native smooth scroll for commands */
      }

      /* ARABIC THEME */
      body.theme-ar {
        direction: rtl;
        font-family: 'Amiri', serif;
        background: radial-gradient(circle at center, #2c1a0e 0%, #000 100%); /* Gold/Brown */
        --accent: #d4af37; /* Gold */
      }

      /* ENGLISH THEME */
      body.theme-en {
        direction: ltr;
        background: radial-gradient(circle at center, #0f172a 0%, #000 100%); /* Teal/Blue */
        --accent: #0097a7; /* Teal */
      }

      /* VISIBILITY LOGIC */
      .content-ar {
        display: none;
      }
      .content-en {
        display: none;
      }
      body.theme-ar .content-ar {
        display: block;
      }
      body.theme-en .content-en {
        display: block;
      }

      /* FIXED STAGE (The Viewport) */
      .stage {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1;
        pointer-events: none;
      }

      /* Background Layer */
      .stage-bg {
        position: absolute;
        inset: 0;
        opacity: 0;
        z-index: 0;
        background-size: cover;
        background-position: center;
        transition:
          opacity 0.8s ease,
          filter 0.8s ease;
        will-change: opacity, filter;
      }

      .stage-bg.active {
        opacity: 1;
        z-index: 1;
      }

      /* LANGUAGE SPECIFIC FILTERS */
      body.theme-ar .stage-bg {
        filter: sepia(0.4) contrast(1.1) brightness(0.7);
      }
      body.theme-en .stage-bg {
        filter: hue-rotate(190deg) saturate(0.6) contrast(1.2) brightness(0.6);
      }

      /* Card Container */
      .card-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        min-height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        perspective: 1000px;
      }

      /* Story Card */
      .story-card {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        background: rgba(0, 0, 0, 0.85);
        padding: 50px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
        opacity: 0;
        transition: all 0.6s ease-out;
        pointer-events: none;
        border-radius: 8px;
        backdrop-filter: blur(5px);
      }

      .story-card.active {
        opacity: 1;
        transform: translate(-50%, -50%);
        pointer-events: auto;
      }

      /* Odd/Even Borders */
      .story-card:not(.special) {
        border-left: 4px solid var(--accent);
      }
      body.theme-en .story-card:not(.special) {
        border-right: 4px solid var(--accent);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
      }
      body.theme-ar .story-card:not(.special) {
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        border-right: 4px solid var(--accent);
      }

      /* Special styles for Epilogue */
      .story-card.special {
        background: transparent;
        border: none;
        box-shadow: none;
        text-align: center;
        backdrop-filter: none;
        padding: 20px;
      }

      /* SCROLL TRACK */
      .scroll-track {
        height: 700vh;
        position: relative;
        z-index: 0;
      }

      /* TYPOGRAPHY */
      h1 {
        font-size: 3.5rem;
        margin: 0 0 20px 0;
        text-shadow: 0 10px 30px #000;
        line-height: 1.2;
      }
      h2 {
        color: var(--accent);
        margin-top: 0;
        font-size: 2rem;
        text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      p {
        line-height: 1.8;
        font-size: 1.25rem;
        color: #e2e8f0;
      }
      .subtitle {
        font-size: 1.2rem;
        letter-spacing: 4px;
        opacity: 0.9;
        text-transform: uppercase;
        margin-top: 10px;
      }

      /* CONTROLS (Switcher, Nav, Sound) */
      .controls-wrapper {
        position: fixed;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      /* Top Left/Right Switcher */
      .switcher {
        position: fixed;
        top: 30px;
        right: 30px;
        z-index: 999;
        display: flex;
        gap: 15px;
      }
      body.theme-ar .switcher {
        right: auto;
        left: 30px;
      }

      button.btn-lang {
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #fff;
        padding: 12px 25px;
        cursor: pointer;
        font-weight: bold;
        font-family: inherit;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s;
        border-radius: 4px;
      }
      button.btn-lang:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      button.btn-lang.active {
        border-color: var(--accent);
        background: rgba(0, 0, 0, 0.8);
        color: var(--accent);
        box-shadow: 0 0 20px var(--accent);
      }

      /* Bottom Left/Right Controls Group */
      .bottom-controls {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
      }
      body.theme-ar .bottom-controls {
        right: auto;
        left: 30px;
      }

      /* Circular Buttons */
      .circle-btn {
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: rgba(255, 255, 255, 0.8);
        width: 45px;
        height: 45px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.3s;
        backdrop-filter: blur(4px);
      }
      .circle-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--accent);
        color: var(--accent);
        transform: scale(1.1);
      }

      .nav-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 10px;
      }

      /* NOTICE */
      .notice-container {
        position: fixed;
        top: 90px;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 600px;
        text-align: center;
        z-index: 100;
        pointer-events: none;
      }

      .notice-text {
        display: inline-block;
        background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.8), transparent);
        color: rgba(255, 255, 255, 0.7);
        padding: 5px 40px;
        font-size: 0.95rem;
        font-style: italic;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      body.theme-ar .notice-text {
        font-family: 'Amiri', serif;
        font-size: 1.1rem;
      }

      /* Scroll Indicator */
      .scroll-hint {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        animation: bounce 2s infinite;
        opacity: 0.7;
        font-size: 2rem;
        z-index: 10;
        text-shadow: 0 0 10px #fff;
        pointer-events: none; /* Let clicks pass if needed */
      }
      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateX(-50%) translateY(0);
        }
        40% {
          transform: translateX(-50%) translateY(-10px);
        }
        60% {
          transform: translateX(-50%) translateY(-5px);
        }
      }

      /* RESPONSIVE */
      @media (max-width: 768px) {
        h1 {
          font-size: 2.2rem;
        }
        h2 {
          font-size: 1.6rem;
        }
        p {
          font-size: 1.1rem;
          line-height: 1.6;
        }
        .story-card {
          padding: 30px;
          width: 90%;
        }
        .switcher {
          top: 20px;
          right: 20px;
          gap: 10px;
        }
        body.theme-ar .switcher {
          left: 20px;
        }
        .btn-lang {
          padding: 8px 15px;
          font-size: 0.8rem;
        }
        .notice-container {
          top: 70px;
        }
        .notice-text {
          font-size: 0.8rem;
          padding: 5px 20px;
        }

        .bottom-controls {
          bottom: 20px;
          right: 20px;
        }
        body.theme-ar .bottom-controls {
          left: 20px;
        }
        .circle-btn {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body class="theme-ar">
    <!-- UI LAYER -->
    <div class="switcher">
      <button class="btn-lang" onclick="switchTheme('en')">IV. The Voyager</button>
      <button class="btn-lang active" onclick="switchTheme('ar')">Ù…Ù„Ø­Ù…Ø© Ø§Ù„ØªÙ…Ø±Ø¯</button>
    </div>

    <!-- MYSTERIOUS DISCLAIMER -->
    <div class="notice-container">
      <div class="notice-text content-ar">...Ø®Ù„Ù Ø§Ù„Ø£ÙÙ‚ØŒ Ù‚Ø¯ ØªÙ‡Ù…Ø³ Ø§Ù„ØµØ®ÙˆØ± Ø¨Ø­ÙƒØ§ÙŠØ© Ø£Ø®Ø±Ù‰</div>
      <div class="notice-text content-en">...Some legends are written in stone, others in stars</div>
    </div>

    <div class="scroll-hint">â‡©</div>

    <!-- THE STAGE (Fixed Viewport) -->
    <div class="stage">
      <!-- BACKGROUNDS -->
      <div class="stage-bg active" id="bg-0"></div>
      <!-- Hero -->
      <div class="stage-bg" id="bg-1" style="background-image: url('assets/story_warrior.png')"></div>
      <div class="stage-bg" id="bg-2" style="background-image: url('assets/story_fortress.png')"></div>
      <div class="stage-bg" id="bg-3" style="background-image: url('assets/story_beacon.png')"></div>
      <div class="stage-bg" id="bg-4" style="background-image: url('assets/story_harmony.png')"></div>
      <div class="stage-bg" id="bg-5" style="background-image: url('assets/story_victory.png')"></div>
      <div class="stage-bg" id="bg-6" style="background-image: url('assets/story_victory.png')"></div>
      <!-- Epilogue Default -->

      <!-- CARDS -->
      <div class="card-container">
        <!-- HERO -->
        <div class="story-card active special" id="card-0">
          <h1 class="content-ar">ØªÙ…Ø±Ø¯ Ø§Ù„Ø­Ø¬Ø±</h1>
          <h1 class="content-en">THE CELESTIAL MIRROR</h1>
          <p class="subtitle content-ar">Ù‡Ù…Ø³Ø§Øª Ù…Ù† Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØµØ§Ù…ØªØ©</p>
          <p class="subtitle content-en">Chronicle 001: The View from Above</p>
        </div>

        <!-- CH 1 -->
        <div class="story-card" id="card-1">
          <div class="content-ar">
            <h2>Ù¡. Ø§Ù„ØµÙ…ØªÙ Ø§Ù„Ù†Ø§Ø·Ù‚</h2>
            <p>ÙÙŠ Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¹ØªÙŠÙ‚ØŒ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† ØµÙ…Ø§Ø¡.. Ø¨Ù„ ÙƒØ§Ù†Øª ØµØ¯ÙˆØ±Ø§Ù‹ ØªØ­Ø¨Ø³ Ø§Ù„Ø£Ù†ÙØ§Ø³. ÙˆÙ‚Ù Ø§Ù„Ø«Ø§Ø¦Ø± ÙˆØ­ÙŠØ¯Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙƒØ³Ø± Ø§Ù„ØµÙ…Øª Ø¨Ø§Ù„Ø¶Ø¬ÙŠØ¬ØŒ Ø¨Ù„ Ø¨Ø§Ù„Ø¥Ù†ØµØ§Øª. ÙØ§Ù„Ø­Ø¬Ø± Ù„Ø§ ÙŠØ¨ÙˆØ­ Ø¨Ø³Ø±Ù‡ØŒ Ø¥Ù„Ø§ Ù„Ù…Ù† Ø§Ù…ØªÙ„Ùƒ <b>ØµØ¯Ù‚ Ø§Ù„Ø«Ø¨Ø§Øª</b>.</p>
          </div>
          <div class="content-en">
            <h2>I. The Static Void</h2>
            <p>
              A silent sphere in the endless flight, <br />
              Hidden deep in the folds of night. <br />
              No signal pulsed, no beacon burn, <br />
              Only the dust, waiting to turn.
            </p>
          </div>
        </div>

        <!-- CH 2 -->
        <div class="story-card" id="card-2">
          <div class="content-ar">
            <h2>Ù¢. Ù„Ù…Ø³Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h2>
            <p>Ù„Ù… ÙŠØ´Ù‡Ø± Ø³ÙŠÙØ§Ù‹ ÙˆÙ„Ù… ÙŠØ±ÙØ¹ Ù…Ø¹ÙˆÙ„Ø§Ù‹.. Ø¨Ù„ ÙˆØ¶Ø¹ ÙƒÙÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø±Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…. ÙØ§Ù†ØªÙØ¶ Ø§Ù„ØµØ®Ø± Ø­ÙŠÙ† ØªØ°ÙƒØ± Ø£ØµÙ„Ù‡ØŒ ÙˆÙ„Ø§Ù† Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø­ÙŠÙ† Ù„Ø§Ù…Ø³ ÙˆØµÙ„Ù‡. Ù„Ù… ÙŠØ¹Ø¯ Ø§Ù„Ø¨Ù†ÙŠØ§Ù† Ø³Ø¬Ù†Ø§Ù‹ ÙŠÙ‚ÙŠØ¯ØŒ Ø¨Ù„ ØµØ§Ø± Ø·ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ù† <b>ÙŠØ³ØªØ¬ÙŠØ¨ Ù„Ù…Ù† ÙŠØ±ÙŠØ¯</b>.</p>
          </div>
          <div class="content-en">
            <h2>II. The Frequency</h2>
            <p>
              A deep vibration, a shift in scale, <br />
              Piercing the crust, tearing the veil. <br />
              The orbit trembles, the poles align, <br />
              Responding to a geometric design.
            </p>
          </div>
        </div>

        <!-- CH 3 -->
        <div class="story-card" id="card-3">
          <div class="content-ar">
            <h2>Ù£. Ø¹Ø±ÙˆÙ‚ Ø§Ù„Ø¶ÙŠØ§Ø¡</h2>
            <p>Ø­ÙŠÙ† Ø£Ø·Ø¨Ù‚ Ø§Ù„Ù„ÙŠÙ„ØŒ Ù„Ù… ÙŠÙ„Ø¹Ù† Ø§Ù„Ø¸Ù„Ø§Ù….. Ø¨Ù„ Ø£Ù…Ø± Ø§Ù„Ø£Ø±Ø¶ Ø£Ù† ØªØ¶ÙŠØ¡. ÙØªÙØ¬Ø±Øª Ù…Ù† ØªØ­Øª Ø£Ù‚Ø¯Ø§Ù…Ù‡ Ø¹Ø±ÙˆÙ‚ Ø§Ù„Ø°Ù‡Ø¨ØŒ Ù†ÙˆØ±ÙŒ ÙŠØ³Ø±ÙŠ ÙÙŠ Ø´Ø±Ø§ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ù…. ÙŠØ±Ø³Ù… Ø¯Ø±Ø¨Ø§Ù‹ Ù„Ù…Ù† Ø¶Ù„ØŒ ÙˆÙŠØ´ÙŠØ¯ Ø¬Ø³Ø±Ø§Ù‹ <b>Ù„Ù…Ù† Ø¨Ø§Ù„Ø­Ù‚ ÙˆØµÙ„</b>.</p>
          </div>
          <div class="content-en">
            <h2>III. The Vector</h2>
            <p>
              A column of light, absolute and sheer, <br />
              Breaking the void, distinct and clear. <br />
              Not born of fire, but of pure intent, <br />
              A signal sent, a message meant.
            </p>
          </div>
        </div>

        <!-- CH 4 -->
        <div class="story-card" id="card-4">
          <div class="content-ar">
            <h2>Ù¤. Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù‚ØµÙŠØ¯Ø©</h2>
            <p>ØªÙ†Ø§Ø«Ø±Øª Ø§Ù„Ø­Ø±ÙˆÙ ÙØ¹Ø§Ø¯ ÙŠØ¬Ù…Ø¹Ù‡Ø§ØŒ ÙˆØ­ÙŠØ¯Ø© ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¹Ø§Ù†ÙŠ ÙØµØ§Ø± ÙŠØ¤Ù„ÙÙ‡Ø§. Ù‡Ù†Ø§ Ø§Ù„ØªØ­Ù… Ø§Ù„Ø­Ø¬Ø± Ø¨Ø§Ù„Ø±Ø¤ÙŠØ©ØŒ ÙˆØ¹Ø§Ù†Ù‚ Ø§Ù„ÙˆØ§Ù‚Ø¹Ù Ø§Ù„Ø£Ù…Ù†ÙŠØ©. Ù„Ù… ØªØ¹Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ø·Ù„Ø§Ù„Ø§Ù‹ Ø¨Ø§Ù„ÙŠØ©ØŒ Ø¨Ù„ ØµØ§Ø±Øª <b>Ù‚ØµÙŠØ¯Ø©Ù‹ Ø¹ØµÙŠØ©Ù‹</b> Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³ÙŠØ§Ù†.</p>
          </div>
          <div class="content-en">
            <h2>IV. The Alignment</h2>
            <p>
              Chaos recedes to a perfect form, <br />
              A quiet center inside the storm. <br />
              The scattered points now drift no more, <br />
              Locked in a pattern unknown before.
            </p>
          </div>
        </div>

        <!-- CH 5 -->
        <div class="story-card" id="card-5">
          <div class="content-ar">
            <h2>Ù¥. Ø¹Ø±Ø´ Ø§Ù„Ù…Ø¹Ù†Ù‰</h2>
            <p>ÙˆÙ…Ø¹ ØªÙ†ÙØ³ Ø§Ù„ØµØ¨Ø­ØŒ Ù„Ù… ÙŠØ¬Ø¯ÙˆØ§ Ù‚ÙŠØ¯Ø§Ù‹ Ø¨Ù„ ÙˆØ¬Ø¯ÙˆØ§ Ù…Ø¬Ø¯Ø§Ù‹. ØªÙ„Ø§Ø´Øª Ø§Ù„Ø£Ø³ÙˆØ§Ø± Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŒ ÙˆØ¨Ù‚ÙŠØª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø£Ø¨Ø¯ÙŠØ©. Ø¬Ù„Ø³ Ø§Ù„Ø«Ø§Ø¦Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù…Ø©ØŒ Ù„Ø§ Ù„ÙŠØ­ÙƒÙ… Ù‚ÙˆÙ…Ø§Ù‹ Ø¨Ø§Ù„Ø³ÙŠÙØŒ Ø¨Ù„ <b>Ù„ÙŠØ­Ø±Ø³ Ø­Ù„Ù…Ø§Ù‹</b> Ø¨Ø§Ù„Ù…Ø¹Ù†Ù‰.</p>
          </div>
          <div class="content-en">
            <h2>V. The Starchart</h2>
            <p>
              The grid is fixed, the coordinates known, <br />
              A new location on the starchart shown. <br />
              From the silence of space, we finally see, <br />
              A world awakening to what it must be.
            </p>
          </div>
        </div>

        <!-- EPILOGUE: THE LEGACY -->
        <div class="story-card special" id="card-6">
          <div class="content-ar">
            <h2 style="font-size: 2.5rem; margin-bottom: 40px; text-shadow: 0 0 20px var(--accent)">Ø±Ø­Ù„Ø© Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·ÙˆØ±</h2>
            <p style="font-size: 1.4rem; line-height: 2.5; opacity: 0.9">
              Ù†ØµÙ Ø§Ù„Ø­ÙƒØ§ÙŠØ© Ù†Ù‚Ø´ØªÙ‡ ÙŠØ¯ÙŒ Ø¹Ù„Ù‰ Ø­Ø¬Ø±.. <br />
              ÙˆØ§Ù„Ù†ØµÙ Ø§Ù„Ø¢Ø®Ø± Ø®Ø·ØªÙ‡ Ø¹ÙŠÙ†ÙŒ Ø¹Ù„Ù‰ Ø£Ø«Ø±.. <br />
              ÙØ¥Ø°Ø§ Ø§Ù„ØªÙ‚Ù‰ Ø§Ù„Ù†ØµÙØ§Ù†.. <b>Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ù‚Ù…Ø±</b>.<br />
              <span style="font-size: 0.8em; opacity: 0.6; display: block; margin-top: 20px">(ÙˆØ§Ù„Ø¨Ù‚ÙŠØ©... ÙÙŠ Ø¬ÙˆÙ Ø§Ù„ØºÙŠØ¨ ØªÙ†ØªØ¸Ø±)</span>
            </p>
            <div style="margin-top: 50px; font-size: 2.5rem; font-family: 'Aref Ruqaa', serif; color: var(--accent); transform: rotate(-5deg); opacity: 0.8">Ø­Ø³Ø§Ù… Ø¹ÙŠØ³Ù‰</div>
          </div>
          <div class="content-en">
            <h2 style="font-size: 2.5rem; margin-bottom: 40px; text-shadow: 0 0 20px var(--accent)">Beyond the Lines</h2>
            <p style="font-size: 1.4rem; line-height: 2.5; opacity: 0.9">
              Two signals merge in the cosmic vast, <br />
              The future reflected in the ancient past. <br />
              When stone meets star in the great design, <br />
              The circle closes, the worlds align.<br />
              <span style="font-size: 0.75em; opacity: 0.6; display: block; margin-top: 20px; font-style: italic">(And the signal... silently continues.)</span>
            </p>
            <div style="margin-top: 50px; font-size: 3rem; font-family: 'Great Vibes', cursive; color: var(--accent); transform: rotate(-5deg); opacity: 0.8">Hosam A.E.</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Closes .stage -->

    <!-- INVISIBLE SCROLL DRIVER -->
    <div class="scroll-track"></div>

    <!-- AUDIO SYSTEM -->
    <audio id="audio-ar" loop preload="auto">
      <source src="assets/ambient_ar.mp3" type="audio/mp3" />
    </audio>
    <audio id="audio-en" loop preload="auto">
      <source src="assets/ambient_en.mp3" type="audio/mp3" />
    </audio>

    <!-- NEW: BOTTOM CONTROLS (NAV + SOUND) -->
    <div class="bottom-controls">
      <div class="nav-group">
        <button id="btn-nav-up" class="circle-btn" onclick="NavManager.goUp()" title="Previous Section (Up Arrow)">â–²</button>
        <button id="btn-nav-down" class="circle-btn" onclick="NavManager.goDown()" title="Next Section (Down Arrow)">â–¼</button>
      </div>
      <button id="sound-toggle" class="circle-btn" onclick="toggleSound()" title="Toggle Sound (M)">
        <span class="icon-off">ğŸ”‡</span>
        <span class="icon-on" style="display: none">ğŸ”Š</span>
      </button>
    </div>

    <script>
      // SOUND MANAGER
      const SoundManager = {
        activeLang: 'ar',
        isMuted: true,
        bgAr: document.getElementById('audio-ar'),
        bgEn: document.getElementById('audio-en'),
        fadeDuration: 2000,

        init() {
          this.bgAr.volume = 0;
          this.bgEn.volume = 0;
          this.updateUI();
        },

        updateUI() {
          const btnOff = document.querySelector('.icon-off');
          const btnOn = document.querySelector('.icon-on');
          if (this.isMuted) {
            btnOff.style.display = 'inline';
            btnOn.style.display = 'none';
          } else {
            btnOff.style.display = 'none';
            btnOn.style.display = 'inline';
          }
        },

        startOnFirstInteraction() {
          // No auto-start logic needed if we rely on explicit toggle for mute/unmute
          // But we keep this if we want to unmute automatically? No, let's keep it safe.
          // We just ensure play() is called when user unmutes.
        },

        toggle() {
          this.isMuted = !this.isMuted;
          this.updateUI();

          if (this.isMuted) {
            this.fadeOut(this.bgAr);
            this.fadeOut(this.bgEn);
          } else {
            this.playActive();
          }
        },

        switchTrack(lang) {
          if (this.activeLang === lang) return;
          this.activeLang = lang;

          if (!this.isMuted) {
            if (lang === 'ar') this.crossFade(this.bgEn, this.bgAr);
            else this.crossFade(this.bgAr, this.bgEn);
          }
        },

        playActive() {
          if (this.activeLang === 'ar') {
            this.bgAr.play().catch(() => {});
            this.fadeIn(this.bgAr);
          } else {
            this.bgEn.play().catch(() => {});
            this.fadeIn(this.bgEn);
          }
        },

        fadeIn(audio) {
          if (audio._fadeInterval) clearInterval(audio._fadeInterval);

          const target = 0.6;
          let vol = audio.volume;
          const step = target / (this.fadeDuration / 50);

          audio.play().catch(() => {});

          audio._fadeInterval = setInterval(() => {
            vol = Math.min(vol + step, target);
            audio.volume = vol;
            if (vol >= target) clearInterval(audio._fadeInterval);
          }, 50);
        },

        fadeOut(audio) {
          if (audio._fadeInterval) clearInterval(audio._fadeInterval);

          let vol = audio.volume;
          const step = vol / (this.fadeDuration / 50);

          audio._fadeInterval = setInterval(() => {
            vol = Math.max(vol - step, 0);
            audio.volume = vol;
            if (vol <= 0) {
              clearInterval(audio._fadeInterval);
              audio.pause();
            }
          }, 50);
        },

        crossFade(fromAudio, toAudio) {
          this.fadeOut(fromAudio);
          this.fadeIn(toAudio);
        },
      };

      SoundManager.init();

      // NAVIGATION MANAGER
      const NavManager = {
        totalSlides: 7,

        getCurrentIndex() {
          const scrollY = window.scrollY;
          const docHeight = document.body.scrollHeight - window.innerHeight;
          if (docHeight <= 0) return 0;
          return Math.floor((scrollY / docHeight) * this.totalSlides);
        },

        scrollToSlide(index) {
          if (index < 0 || index >= this.totalSlides) return;

          const docHeight = document.body.scrollHeight - window.innerHeight;
          // Add 0.05 to index to ensure we cross the threshold into the slide
          const targetPercent = (index + 0.05) / this.totalSlides;
          const targetY = targetPercent * docHeight;

          window.scrollTo({
            top: targetY,
            behavior: 'smooth',
          });
        },

        goDown() {
          const current = this.getCurrentIndex();
          if (current < this.totalSlides - 1) {
            this.scrollToSlide(current + 1);
          }
        },

        goUp() {
          const current = this.getCurrentIndex();
          if (current > 0) {
            this.scrollToSlide(current - 1);
          }
        },

        updateButtons(index) {
          const btnUp = document.getElementById('btn-nav-up');
          const btnDown = document.getElementById('btn-nav-down');

          if (btnUp) btnUp.style.display = index <= 0 ? 'none' : 'flex';
          if (btnDown) btnDown.style.display = index >= this.totalSlides - 1 ? 'none' : 'flex';
        },
      };

      function toggleSound() {
        SoundManager.toggle();
      }

      function switchTheme(lang) {
        document.body.classList.remove('theme-ar', 'theme-en');
        document.body.classList.add('theme-' + lang);

        SoundManager.switchTrack(lang);

        const heroBg = document.getElementById('bg-0');
        if (heroBg) {
          if (lang === 'ar') heroBg.style.backgroundImage = "url('assets/story_hero_stone.png')";
          else heroBg.style.backgroundImage = "url('assets/story_hero_void.png')";
        }

        document.querySelectorAll('.btn-lang').forEach((btn) => {
          btn.classList.remove('active');
          if ((lang === 'ar' && btn.innerText.includes('Ø§Ù„ØªÙ…Ø±Ø¯')) || (lang === 'en' && btn.innerText.includes('Voyager'))) {
            btn.classList.add('active');
          }
        });
      }

      switchTheme('ar');

      // OPTIMIZED SCROLL LOGIC
      const stageBgs = document.querySelectorAll('.stage-bg');
      const storyCards = document.querySelectorAll('.story-card');
      const hint = document.querySelector('.scroll-hint');
      let ticking = false;

      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            updateScroll();
            ticking = false;
          });
          ticking = true;
        }
      }

      function updateScroll() {
        const scrollY = window.scrollY;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        if (docHeight <= 0) return;

        const scrollPercent = Math.min(Math.max(scrollY / docHeight, 0), 0.999);
        const totalSlides = 7;
        const activeIndex = Math.floor(scrollPercent * totalSlides);

        // Update Nav Buttons
        NavManager.updateButtons(activeIndex);

        stageBgs.forEach((bg, index) => {
          if (index === activeIndex) bg.classList.add('active');
          else bg.classList.remove('active');
        });

        storyCards.forEach((card, index) => {
          if (index === activeIndex) card.classList.add('active');
          else card.classList.remove('active');
        });

        if (hint && scrollY > 50) hint.style.opacity = '0';
      }

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('load', updateScroll);
      updateScroll();

      // KEYBOARD SHORTCUTS
      document.addEventListener('keydown', (e) => {
        // 'm' or 'M' for Mute Toggle
        if (e.key === 'm' || e.key === 'M') {
          toggleSound();
        }

        // Arrow Down / Up for Navigation
        if (e.key === 'ArrowDown' || e.key === 'PageDown') {
          e.preventDefault(); // Prevent default jerky scroll
          NavManager.goDown();
        }

        if (e.key === 'ArrowUp' || e.key === 'PageUp') {
          e.preventDefault();
          NavManager.goUp();
        }
      });
    </script>
  </body>
</html>
